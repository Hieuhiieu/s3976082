{% extends 'layout.html' %}
{% block title %}Level 2A — Vaccination by Country/Region{% endblock %}
{% block content %}
<h2>Vaccination rates by country & region</h2>
<form method="post" class="filters">
  <label>Antigen
    <select name="antigen" required>
      <option value="">Select antigen</option>
      {% for a in antigens %}
      <option value="{{a['AntigenID']}}" {% if selected.antigen==a['AntigenID'] %}selected{% endif %}>{{a['name']}}</option>
      {% endfor %}
    </select>
  </label>
  <label>Year
    <select name="year" required>
      <option value="">Year</option>
      {% for y in years %}<option value="{{y}}" {% if selected.year==y|string %}selected{% endif %}>{{y}}</option>{% endfor %}
    </select>
  </label>
  <label>Region (optional)
    <select name="region">
      <option value="">All regions</option>
      {% for r in regions %}
      <option value="{{r['RegionID']}}" {% if selected.region==r['RegionID'] %}selected{% endif %}>{{r['region']}}</option>
      {% endfor %}
    </select>
  </label>
  <button class="btn">Apply</button>
</form>
{% if table1 %}
<h3>Countries met ≥90% target</h3>
<table class="table">
  <thead><tr><th>Antigen</th><th>Year</th><th>Country</th><th>Region</th><th>% of target</th></tr></thead>
  <tbody>
  {% for row in table1 %}
    <tr>
      <td>{{row['antigen']}}</td>
      <td>{{row['year']}}</td>
      <td>{{row['country']}}</td>
      <td>{{row['region']}}</td>
      <td>{{'%.0f'| format(row['percentage_of_target'] or 0)}}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
<h3>Per-region count meeting ≥90%</h3>
<table class="table">
  <thead><tr><th>Antigen</th><th>Year</th><th>Region</th><th>Countries met 90%</th></tr></thead>
  <tbody>
  {% for row in table2 %}
    <tr>
      <td>{{row['antigen']}}</td>
      <td>{{row['year']}}</td>
      <td>{{row['region']}}</td>
      <td>{{row['countries_met_90']}}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endif %}
{% endblock %}
